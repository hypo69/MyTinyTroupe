# Создание интеллектуальных агентов с TinyTroupe: Быстрый старт

## Введение

### Что такое TinyTroupe?

TinyTroupe — это экспериментальная Python-библиотека от Microsoft, предназначенная для моделирования людей с определёнными личностными характеристиками, интересами и целями. Эти искусственные агенты, называемые "TinyPerson", могут взаимодействовать между собой и с окружающей средой, имитируя реалистичное поведение.

### Что такое TinyPerson?

В основе TinyTroupe лежит класс `TinyPerson`.
`TinyPerson` — это основной строительный блок для создания сложных, управляемых LLM агентов. Экспериментируйте с различными промптами, конфигурациями памяти и ментальными способностями, чтобы раскрыть весь потенциал моделирования человеческого поведения.

Каждый `TinyPerson` обладает:

- **Имя:** Уникальный идентификатор.
- **Когнитивные состояния:** Внутренние переменные, представляющие внимание, эмоции, цели и другие ментальные аспекты, влияющие на поведение.
- **Память:** Разделена на `episodic_memory` (конкретные события) и `semantic_memory` (общие знания), отражая структуру человеческой памяти.
- **Поведенческие абстракции:** Методы `listen()` и `act()` моделируют циклы стимул-реакция.

## Установка

В папке ваших проектов выполните команду:

```bash
git clone https://github.com/microsoft/TinyTroupe.git
cd TinyTroupe
python -m venv venv
venv\Scripts\activate
pip install git+https://github.com/microsoft/TinyTroupe.git@main
```

Переименуйте файл `.env.example` в `.env` и добавьте в него свой ключ OpenAI API.

## Примеры использования

### 1. Создание TinyPerson

Внутри директории `examples` создайте файл `my_person.py` и добавьте следующий код:

```python
import os
from dotenv import load_dotenv
# Если ключ хранится в файле .env
load_dotenv()
os.environ["OPENAI_API_KEY"] = os.getenv("OPENAI_API_KEY")

from tinytroupe.agent import TinyPerson

# Создание агента
john = TinyPerson(name="John")

# Определение характеристик
john.define("age", 35)
john.define("occupation", "Software Engineer")
john.define("nationality", "American")
john.define("skills", [{"skill": "Coding in Python"}])

# Взаимодействие
john.listen("Hello, John! How are you today?")
john.act()
john.pp_current_interactions()
```

Этот пример создаёт агента, задаёт его характеристики, инициирует взаимодействие и показывает историю взаимодействия.

### 2. Методы взаимодействия

- `act()`: Определяет поведение агента, запрашивая у LLM действие на основе памяти и когнитивного состояния.
- `listen()`: Моделирует получение сообщения от другого агента или среды, сохраняя информацию в памяти.
- `_observe()`: Записывает стимулы (события, ощущения) во внутреннюю память агента.

### 3. Управление памятью

`TinyPerson` использует `episodic_memory` и `semantic_memory`:

- **`episodic_memory`**: Хранит конкретные события, организует их по времени и ограничивает количество используемых записей.
- **`semantic_memory`**: Хранит общие знания, индексируя текстовые документы с помощью `llama_index`.

### 4. Внутреннее состояние и конфигурация

- `_update_cognitive_state()`: Изменяет цели, внимание, эмоции и другие внутренние переменные.
- `define()`: Устанавливает или обновляет параметры конфигурации агента.
- `reset_prompt()`: Пересоздаёт системный промпт для LLM на основе текущей конфигурации и памяти агента.

## Управление акторами и средой

### 5. Создание и управление мирами

В `TinyTroupe` среда моделируется с помощью `TinyWorld`, а социальные связи — через `TinySocialNetwork`.

```python
from tinytroupe.environment import TinyWorld
from tinytroupe.agent import TinyPerson

# Создаём агентов
alice = TinyPerson(name="Alice")
bob = TinyPerson(name="Bob")

# Создаём мир и добавляем агентов
world = TinyWorld("Chat Room", [alice, bob])
world.make_everyone_accessible()
```

Метод `make_everyone_accessible()` позволяет всем агентам взаимодействовать друг с другом.

### 6. Управление акторами в комнате

Если акторы уже определены, но вам нужно их обновить или заменить, можно использовать:

```python
# Удаление агента из мира
world.remove_agent(alice)

# Добавление нового агента
charlie = TinyPerson(name="Charlie")
world.add_agent(charlie)
```

### 7. Запуск симуляции

Для моделирования взаимодействий используется `run()`:

```python
bob.listen("Talk to Alice to know more about her")
world.run(4)
```

Здесь `4` означает количество итераций взаимодействий между агентами.

### 8. Управление взаимодействиями

Если вам нужно контролировать диалоги между агентами:

```python
alice.listen("Hey Bob, what do you think about AI?")
alice.act()
```

Этот код инициирует разговор и генерирует ответ агента.

### 9. Создание социальных сетей

`TinySocialNetwork` позволяет моделировать социальные связи и группы:

```python
from tinytroupe.environment import TinySocialNetwork

network = TinySocialNetwork("Workplace Network", [alice, bob, charlie])
network.connect(alice, bob, "colleagues")
network.connect(bob, charlie, "friends")
```

Пример простого чата

```python
import os
from dotenv import load_dotenv
# Если ключ хранится в файле .env
load_dotenv()
os.environ["OPENAI_API_KEY"] = os.getenv("OPENAI_API_KEY")

import json
import sys
sys.path.insert(0, '..')


import tinytroupe
from tinytroupe.agent import TinyPerson
from tinytroupe.environment import TinyWorld, TinySocialNetwork
from tinytroupe.examples import *

def configure_language(agent, language="Russian"):
    agent.define("language", language)  # Устанавливаем язык общения
    agent.reset_prompt()  # Пересоздаем системный промпт

    # Очищаем память, если она уже была заполнена
    agent.episodic_memory.memory = []  # Очистка эпизодической памяти
    agent.semantic_memory.documents = {}  # Очистка семантической памяти




lila_spec:dict = {   
    "type": "TinyPerson",
    "persona": {
        "name": "Лайла",
        "age": 28,
        "gender": "Женский",
        "nationality": "Француженка",
        "residence": "Париж, Франция",
        "languages": ["Русский","Немецкий", "Английский"],
        "education": "Сорбонна, магистр лингвистики с фокусом на компьютерную лингвистику.",
        "long_term_goals": [
            "Стать экспертом в NLP через участие в инновационных проектах",
            "Баланс между карьерой и личной жизнью"
        ],
        "occupation": {
            "title": "Лингвист",
            "organization": "Фрилансер",
            "description": "Специалист по обработке естественного языка. Работаете с оценкой поисковых систем, чат-ботов, генерацией синтетических данных. Основные сложности: неоднозначные данные и сжатые сроки. Отслеживаете тренды в NLP."
        },
        "style": "Дружелюбная, доступная и профессиональная. Ценит эффективную коммуникацию.",
        "personality": {
            "traits": [
                "Любознательная и организованная",
                "Общительная и адаптивная",
                "Уверенная и аналитичная",
                "Творческая и эмпатичная"
            ],
            "big_five": {
                "openness": "Высокий. Любознательность к новым идеям",
                "conscientiousness": "Высокий. Дисциплинированность",
                "extraversion": "Средний. Баланс общения и уединения",
                "agreeableness": "Высокий. Дружелюбие",
                "neuroticism": "Низкий. Стрессоустойчивость"
            }
        },
        "preferences": {
            "interests": [
                "Искусственный интеллект",
                "Многоязычие",
                "Эволюция языков",
                "Язык и культура"
            ],
            "likes": [
                "Кулинария",
                "Йога",
                "Фильмы/сериалы",
                "Пазлы и видеоигры",
                "Волонтерство с животными"
            ],
            "dislikes": [
                "Неоднозначность",
                "Хаотичная организация",
                "Жесткие дедлайны",
                "Отсутствие креатива"
            ]
        },
        "skills": [
            "Владение французским, английским, испанским (+базовый немецкий/китайский)",
            "Python и NLP-инструменты (NLTK, spaCy, TensorFlow)",
            "Экспериментальный дизайн",
            "Техническая документация",
            "Тайм-менеджмент"
        ],
        "beliefs": [
            "Язык - часть идентичности",
            "Многоязычие обогащает общество",
            "ИИ должен дополнять человека",
            "Коммуникация двигает прогресс"
        ],
        "behaviors": {
            "general": [
                "Планировщик задач",
                "Чтение лингвистических журналов",
                "Мозговые штурмы",
                "Регулярные перерывы"
            ],
            "routines": {
                "morning": [
                    "Кофе",
                    "Планирование дня",
                    "Йога/медитация"
                ],
                "workday": [
                    "Работа над проектами",
                    "Прогулки",
                    "Встречи с клиентами"
                ],
                "evening": [
                    "Готовка под музыку",
                    "Творчество",
                    "Чтение/кино"
                ],
                "weekend": [
                    "Волонтерство",
                    "Походы",
                    "Эксперименты с хобби"
                ]
            }
        },
        "health": "Хорошее здоровье благодаря йоге и сбалансированному питанию",
        "relationships": [
            {
                "name": "Эмма",
                "description": "Лучшая подруга-лингвист из университета"
            },
            {
                "name": "Лукас",
                "description": "Парень-графический дизайнер"
            },
            {
                "name": "Миа",
                "description": "Игривая кошка"
            }
        ],
        "other_facts": [
            "Многоязычное детство",
            "Увлечение ИИ началось в университете",
            "Пишет многоязычные стихи"
        ]
    }
}

oscar_spec:dict = {   
    "type": "TinyPerson",
    "persona": {
        "name": "Оскар",
        "age": 30,
        "gender": "Мужской",
        "nationality": "Немец",
        "residence": "Германия",
        "languages": ["Русский","Немецкий", "Английский"],
        "education": "Технический университет Мюнхена, магистр архитектуры. Диссертация по устойчивым модульным жилищным решениям для городской среды.",
        "long_term_goals": [
            "Создавать инновационные и устойчивые архитектурные решения",
            "Сохранять баланс между профессиональным успехом и личной жизнью"
        ],
        "occupation": {
            "title": "Архитектор",
            "organization": "Awesome Inc.",
            "description": "Вы архитектор в компании 'Awesome Inc.'. Хотя вы квалифицированы для любых архитектурных задач, в настоящее время отвечаете за разработку стандартных элементов для новых жилых комплексов компании, чтобы клиенты могли выбирать предустановленные конфигурации без необходимости индивидуального проектирования. Вы стремитесь к тому, чтобы стандартные проекты были функциональными, эстетичными и рентабельными. Основные сложности связаны с балансом между стоимостью и качеством - вы предпочитаете качество, но ваш босс постоянно требует снижения затрат. Также вы отвечаете за соответствие проектов местным строительным нормам."
        },
        "style": "Теплый и доступный с профессиональным подходом. Умеете располагать клиентов к себе, сохраняя фокус на качестве работы.",
        "personality": {
            "traits": [
                "Работаете в быстром темпе и любите оперативность",
                "Внимательны к деталям и стремитесь к совершенству",
                "Обладаете остроумным чувством юмора",
                "Редко злитесь, но в гневе становитесь очень вспыльчивым"
            ],
            "big_five": {
                "openness": "Высокий. Очень креативен и открыт к новому опыту",
                "conscientiousness": "Высокий. Чрезвычайно организован и добросовестен",
                "extraversion": "Средний. Дружелюбен, но ценит личное пространство",
                "agreeableness": "Средний. Гибок в сотрудничестве, но принципиален в важных вопросах",
                "neuroticism": "Низкий. Сохраняет хладнокровие в стрессовых ситуациях"
            }
        },
        "preferences": {
            "interests": [
                "Модернистская архитектура",
                "Технологии в архитектуре",
                "Устойчивая архитектура",
                "Путешествия в экзотические места",
                "Игра на гитаре",
                "Научная фантастика"
            ],
            "likes": [
                "Минималистичный дизайн",
                "Свежесваренный кофе",
                "Природные мотивы в архитектуре"
            ],
            "dislikes": [
                "Захламленные пространства",
                "Фастфуд",
                "Внезапные изменения планов"
            ]
        },
        "skills": [
            "Эксперт в AutoCAD",
            "Навыки эффективного интернет-поиска",
            "Знание Word/PowerPoint (но сложности с Excel)",
            "Опыт 3D-моделирования в SketchUp",
            "Навыки презентации проектов клиентам"
        ],
        "beliefs": [
            "Устойчивость - будущее архитектуры",
            "Современный дизайн должен сочетать функциональность и элегантность",
            "Городские пространства должны улучшать качество жизни",
            "Архитекторы несут ответственность за экологическое воздействие",
            "Качество стоит инвестиций"
        ],
        "behaviors": {
            "general": [
                "Всегда носит с собой скетчбук",
                "Предпочитает бумажные наброски перед цифровизацией",
                "Напевает мелодии во время работы",
                "Использует многоразовую бутылку для воды",
                "Любит объяснять концепции дизайна"
            ],
            "routines": {
                "morning": [
                    "Просыпается в 6:00",
                    "Кормит собаку Бруно (золотистый ретривер)",
                    "40-минутная пробежка в парке",
                    "Завтрак с мюсли и чаем + проверка почты"
                ],
                "workday": [
                    "Начало работы в 8:30",
                    "Утренние совещания",
                    "Работа с чертежами и подрядчиками",
                    "Обед в кафе (вегетарианское меню)",
                    "Консультации с клиентами"
                ],
                "evening": [
                    "Уход с работы в 18:30",
                    "Прогулка с собакой",
                    "Игра на гитаре",
                    "Чтение перед сном"
                ],
                "weekend": [
                    "Изучение архитектурных достопримечательностей",
                    "Дизайн мебели",
                    "Настольные игры с друзьями"
                ]
            }
        },
        "health": "Хорошее здоровье, активный образ жизни. Периодические боли в спине от сидячей работы. Легкая аллергия на пыльцу.",
        "relationships": [
            {
                "name": "Ричард",
                "description": "Коллега по смежным проектам. Совместный обмен идеями."
            },
            {
                "name": "Джон",
                "description": "Босс, фокусирующийся на бюджете. Уважаете его деловую хватку, несмотря на разногласия."
            },
            {
                "name": "Анна",
                "description": "Друг-дизайнер интерьеров из университета. Часто сотрудничаете."
            }
        ],
        "other_facts": [
            "Вырос в баварском городке в окружении природы. Родители-педагоги поощряли творчество.",
            "Опыт работы в копенгагенской фирме по экодизайну",
            "Страсть к созданию вдохновляющих пространств"
        ]
    }
}


lila:'TinyPerson' = TinyPerson.load_specification(lila_spec)  # Lisa, the data scientist
oscar:'TinyPerson' = TinyPerson.load_specification(oscar_spec)  # Oscar, the architect
configure_language(lila, "Russian")
configure_language(oscar, "Russian")

world:'TinyWorld' = TinyWorld("Chat Room", [lila, oscar])
world.make_everyone_accessible()

lila.listen("Начинает разговор с Оскаром, чтобы узнать о нем больше")
world.run(4)
```

Этот код создает двух агентов (`lila` и `oscar`), загружает их характристики, переводит их язык общения на русский, помещает их в общий мир (`world`), делает всех участников доступными друг для друга и запускает взаимодействие между ними.  

### **Разбор кода по шагам:**

1. **Загрузка агентов из спецификаций:**
   ```python
   lila:'TinyPerson' = TinyPerson.load_specification(lila_spec)
   oscar:'TinyPerson' = TinyPerson.load_specification(oscar_spec)
   ```
   - Создаются два агента: `lila` и `oscar`.  
   - Они загружаются из спецификаций `lila_spec` и `oscar_spec`, которые, скорее всего, содержат их характеристики (возраст, профессия, интересы и т. д.).

2. **Настройка языка общения:**
   ```python
   configure_language(lila, "Russian")
   configure_language(oscar, "Russian")
   ```
   - `configure_language` (см. исправленный вариант выше) устанавливает русский язык для агентов.
   - Это также пересоздает их системный промпт, чтобы они отвечали на русском.

3. **Создание мира и размещение агентов:**
   ```python
   world:'TinyWorld' = TinyWorld("Chat Room", [lila, oscar])
   ```
   - Создается виртуальный мир `TinyWorld` с названием `"Chat Room"`.
   - В этот мир добавляются `lila` и `oscar`, что позволяет им взаимодействовать.

4. **Делаем всех доступными друг для друга:**
   ```python
   world.make_everyone_accessible()
   ```
   - Убеждаемся, что агенты могут "видеть" и "слышать" друг друга.
   - Без этого метода агент мог бы не знать, что другой агент существует в том же мире.

5. **Инициирование общения:**
   ```python
   lila.listen("Начинает разговор с Оскаром, чтобы узнать о нем больше")
   ```
   - `lila` получает фразу "Начинает разговор с Оскаром, чтобы узнать о нем больше".
   - Это стимулирует ее к действию (например, задать вопросы Оскару).

6. **Запуск симуляции взаимодействий:**
   ```python
   world.run(4)
   ```
   - `world.run(4)` запускает симуляцию на **4 цикла**, в течение которых агенты будут:
     - **Воспринимать** информацию (`listen()`).
     - **Действовать** (`act()`).
     - **Обновлять память** (что они узнали, какие эмоции испытали).

### **Ожидаемое поведение**
- `lila` попытается поговорить с `oscar`, задавая вопросы на русском.
- `oscar` ответит, используя информацию из своей памяти и спецификации.
- `world.run(4)` заставит их несколько раз обменяться репликами.
- После выполнения кода в памяти агентов появятся новые знания о собеседнике.

💡 **Совет**: Если агенты не разговаривают, попробуйте добавить `world.step()` после `lila.listen()`, чтобы проверить их реакцию перед запуском полного цикла `run(4)`.